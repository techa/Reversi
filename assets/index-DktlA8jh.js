(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();var C=(a=>(a[a.OutSide=-1]="OutSide",a[a.Null=0]="Null",a[a.B=1]="B",a[a.W=2]="W",a))(C||{});const $=[[0,-1],[0,1],[1,0],[-1,0],[1,-1],[-1,1],[-1,-1],[1,1]];class _{constructor(e={}){this.boardSize=8,this.initialPlacement="cross",this.mode="2",this.yourColor=1,this.turn=1,this.sym=1,this.tiles=[],this.opens=[],this.botMode=!1,this.demo=!1,this.singlePlayerMode=!1,this.whiteCount=0,this.blackCount=0,this.boardSize=e.boardSize??this.boardSize,this.initialPlacement=e.initialPlacement??this.initialPlacement,this.mode=e.mode??this.mode,this.random=e.random??Math.random,this.initialPlacement==="random"&&(this.initialPlacement=this.random()>.5?"cross":"parallel"),this.yourColor=e.yourColor||this.yourColor||this.random()>.5?1:2}countIncr(){this.turn++,this.sym=this.turn%2===0?2:1}get player1Name(){const e=this.mode;return e==="2"?"Player 1":e==="single"&&this.yourColor===1?"You":"AI - Black"}get player2Name(){const e=this.mode;return e==="2"?"Player 2":e==="single"&&this.yourColor===2?"You":"AI - White"}init(){return this.initBoardArray(),this.initialPieces(),this.mode==="single"?(this.singlePlayerMode=!0,this.botMode=!0):this.mode==="demo"&&(this.demo=!0),this.demo||this.yourColor!==this.sym?(this.botMode=!0,this.$aiTurn()):this.$playerTurn(),this}initBoardArray(){this.tiles=[];for(let e=0;e<this.boardSize**2;e++)this.tiles.push(0)}initialPieces(e=this.initialPlacement){const t=(this.boardSize/2|0)-1;for(let i=0;i<4;i++){let s=t,o=t;(i===2||i===3)&&(o+=1),(i===1||i===3)&&(s+=1);let r=1;(e==="cross"&&(!i||i===3)||e==="parallel"&&i<2)&&(r=2),this.$setTile(s,o,r)}this.$tilesCounting()}isTileEmpty(e,t){return this.getTile(e,t)===0}getTile(e,t){return e<0||t<0||e>=this.boardSize||t>=this.boardSize?-1:this.tiles[t*this.boardSize+e]}$setTile(e,t,i){this.tiles[t*this.boardSize+e]=i}$aiTurn(){var e;if(this.botMode){const t=this.ai_nextHand();this._doTheMove(t.x,t.y,!0)}else this.demo&&(this.demo=!1,(e=this.$stopDualBotMode)==null||e.call(this))}checkOKtoPlace(e,t){for(const i of $)if(this.checkDirection(e,t,i))return!0;return!1}checkDirection(e,t,i){const{boardSize:s,sym:o}=this,r=i[0],n=i[1],h=[e<2,!1,e>s-3][r+1],m=[t<2,!1,t>s-3][n+1];if(!(h||m)){const u=this.getTile(e+r,t+n);if(u&&u!==o){const c=r<0?e:s-e-1,p=n<0?t:s-t-1,y=(r&&n?Math.min(c,p):r?c:n?p:0)+1;for(let v=2;v<y;v++){const w=this.getTile(e+v*r,t+v*n);if(w===o)return!0;if(!w)return!1}}}return!1}addTile(e,t){this.checkOKtoPlace(e,t)?(this.$removePredictionDots(),this._doTheMove(e,t)):this.S_invalid()}hit(e,t){return this.$setTile(e,t,this.sym),this._changeRespectiveTiles(e,t),this.countIncr(),this._checkSlots()}_doTheMove(e,t,i=!1){this.S_place(),this.$updateLastMove(e,t);const s=this.hit(e,t);this.$tilesCounting(),s.empty>0?s.movable>0?(this.$glowchange(),i?this.singlePlayerMode?(this.$startBackAllClicks(),this.$playerTurn()):this.$aiTurn():(this.singlePlayerMode?this.$tempStopAllClicks():this.$playerTurn(),this.botMode&&this.$aiTurn())):(this.countIncr(),this._checkSlots().movable>0?i?this.$aiTurn():this.$playerTurn():(this.botMode=!1,i||this.$tempStopAllClicks(),this.$checkWin())):(this.botMode=!1,i||this.$tempStopAllClicks(),this.$checkWin())}_checkSlots(){let e=0,t=0;for(let i=0;i<this.boardSize;i++)for(let s=0;s<this.boardSize;s++)this.isTileEmpty(s,i)&&(e++,this.checkOKtoPlace(s,i)&&t++);return{empty:e,movable:t}}$tilesCounting(){this.whiteCount=0,this.blackCount=0;for(const e of this.tiles)e===2&&(this.whiteCount+=1),e===1&&(this.blackCount+=1)}_changeRespectiveTiles(e,t){this.directionEach(e,t,(i,s)=>{this.tiles[s*this.boardSize+i]=this.sym,this.$changeTileClassByNum(this.boardSize*s+i,this.sym)})}directionEach(e,t,i){for(const s of $)if(this.checkDirection(e,t,s)){let o=!1;const r=s[0],n=s[1];for(;!o;)if(this.isTileEmpty(e+r,t+n))o=!0;else{let h=1,m=e+r*h,u=t+n*h;for(;this.getTile(m,u)!==this.sym;)i(m,u),h++,m=e+r*h,u=t+n*h;o=!0}}}$checkWin(){return this.blackCount>this.whiteCount?`${this.player1Name} Win!`:this.blackCount<this.whiteCount?`${this.player2Name} Win!`:"It is a Draw!!"}S_invalid(){throw new Error("addTile: invalid position x or y")}}const k=[{},{count:[1,1,1]},{count:[-1,0,1],opens:[0,1,.5],position_corner:.5,blur:3},{count:[-1,0,1],opens:[0,1,.5],position_corner:1,position_corner_clue:-1,position_edge:[1,-.5],blur:2},{count:[-1,0,1],opens:[.5,.5,.5],opensAll:[0,1,.5],position_corner:1,position_corner_clue:-1,position_edge:[.5,-.5,.5],blur:1},{count:[-1,0,1],opens:[.5,.5,.5],opensAll:[0,1,.5],position_corner:1,position_corner_clue:-1,position_edge:[.5,-.5,.5],next_turn:100,fixed:1,blur:0}];class L extends _{constructor(e={}){super(e),this.boardLog=[],this.thinking=!1,this.aiPlayer1LV=e.aiPlayer1LV??1,this.aiPlayer2LV=e.aiPlayer2LV??1}_corner_clue(e,t,i,s){const o=i>2?-1:1,r=s>2?-1:1;return this.isTileEmpty(i,s)&&((i>2?e>=i-1:e<=1)&&t===s+r||(s>2?t>=s-1:t<=1)&&e===i+o)}getScore(e,t){const{x:i,y:s,scores:o}=e,{boardSize:r,term:n}=this,{count:h,opens:m,opensAll:u,position_corner:c,position_corner_clue:p,position_edge:y,next_turn:v,fixed:w}=k[t];h&&(o.count+=e.count*h[n]),u&&(o.opensAll+=(r-this.openedAll(i,s)/e.count)*u[n]),m&&(o.opens+=(r-this.opened(i,s))*m[n]);const g=r-1;if(c&&(i===0&&s===0||i===0&&s===g||i===g&&s===0||i===g&&s===g)&&(o.position_corner+=r*c),p&&(this._corner_clue(i,s,0,0)||this._corner_clue(i,s,0,g)||this._corner_clue(i,s,g,0)||this._corner_clue(i,s,g,g))&&(o.position_corner_clue+=r*p),y)for(let d=0;d<y.length;d++)(i===d||i===g-d)&&(o.position_edge[d]+=r*y[d]),(s===d||s===g-d)&&(o.position_edge[d]+=r*y[d]);if(v){if(this.logging(),this.term===2){const d=this.hit(i,s);d.empty&&(d.movable||(o.next_turn+=v))}this.reset()}w&&(o.fixed+=e.fixed*w);for(const d in o){const S=o[d];Array.isArray(S)?o.total+=S.reduce((T,P)=>T+P,0):d!=="total"&&typeof S=="number"&&(o.total+=S)}return e}logging(){this.thinking=!0,this.boardLog.push({tiles:this.tiles.slice(),counter:this.turn})}reset(e=0){const t=this.boardLog[e];if(t){const{tiles:i,counter:s}=t;this.tiles=i,this.turn=s,this.sym=this.turn%2===0?C.W:C.B}this.boardLog=[],e||(this.thinking=!1)}get term(){const e=this.countPer;if(e>.8)return 2;if(e>.6){if(this.random()>(e-.6)/.2)return 2}else{if(e>.4)return 1;if(e>.2&&this.random()>(e-.2)/.2)return 1}return 0}get countPer(){const e=this.boardSize**2-4;return this.turn/e}ai_nextHand(){const e=this.sym===C.B?this.aiPlayer1LV:this.aiPlayer2LV;return this.pick(this.getHands(e),k[e].blur)}pick(e,t=.001){return e=e.filter(i=>i.scores.total>=this.hiScore-t).sort((i,s)=>s.scores.total-i.scores.total),e[Math.floor(this.random()*e.length)]}getHands(e){const{boardSize:t}=this,i=[];this.hiScore=-1/0;for(let s=0;s<t;s++)for(let o=0;o<t;o++)if(this.isTileEmpty(o,s)&&this.checkOKtoPlace(o,s)){const r=this.getHand(o,s,e);r.scores.total>this.hiScore&&(this.hiScore=r.scores.total),r&&i.push(r)}return i}getHand(e,t,i){const s={x:e,y:t,count:this.accumulator(e,t),opens:this.opened(e,t),opensAll:this.openedAll(e,t),fixed:this.fixedCount(e,t),scores:{count:0,opens:0,opensAll:0,position_corner:0,position_corner_clue:0,position_edge:[0,0,0],next_turn:0,fixed:0,total:0}};return this.getScore(s,i),s}accumulator(e,t){let i=0;return this.directionEach(e,t,()=>i++),i}_opened(e,t,i=!1){const{boardSize:s}=this;$.forEach(o=>{const r=e+o[0],n=t+o[1];if(r>=0&&r<s&&n>=0&&n<s&&(!i||i[0]!==r||i[1]!==n)&&this.isTileEmpty(r,n)){const h=n*s+r;this.opens.indexOf(h)===-1&&this.opens.push(h)}})}opened(e,t){return this.opens=[],this._opened(e,t),this.opens.length}openedAll(e,t){return this.opens=[],this.directionEach(e,t,(i,s)=>{this._opened(i,s,[e,t])}),this._opened(e,t),this.opens.length}fixed(e,t,i,s){let o=[],r=[],n;const h=c=>c.some(p=>(n=p)!==e),m=c=>{let p=e;for(let y=0;y<c.length;y++){const v=c[y];if(v===C.Null){if(n===C.Null||p===C.Null)return!0;if(p!==e)return c.length-y>1}p=v}return!1},u=(c,p)=>s&&c===s[0]&&p===s[1]?this.sym:this.getTile(c,p);for(let c=0;c<8;c++){const[p,y]=$[c];c%2===0&&(o=[],r=[]);let v=0;for(;;){v++;let w=t+p*v,g=i+y*v;const d=u(w,g);if(d===C.OutSide)break;c%2===0?o.push(d):r.push(d)}if(c%2&&(h(o)&&m(r)||h(r)&&m(o)))return!1}return!0}fixedCount(e,t){let i=0;return this.directionEach(e,t,(s,o)=>{this.fixed(this.sym,s,o,[e,t])&&i++}),this.fixed(this.sym,e,t)&&i++,i}}const A="/Reversi/assets/button-21-DYoJOxhZ.mp3",M="/Reversi/assets/button-24-DyWko4Bq.mp3",B="/Reversi/assets/button-16-CUHLgPTu.mp3";var b=(a=>(a[a.Beep=0]="Beep",a[a.Invalid=1]="Invalid",a[a.Place=2]="Place",a))(b||{});class E{constructor(){this.mute=!1,this.sounds={0:new Audio,1:new Audio,2:new Audio},this.sounds[0].src=A,this.sounds[1].src=M,this.sounds[2].src=B}sePlay(e){this.mute||this.sounds[e].play()}}function l(a){a=typeof a=="number"?`#cell${a}`:a;const e=document.querySelector(a);if(e)return e;throw new TypeError(`(${a}) is invaild query`)}function f(a){const e=document.createElement("div");return e.setAttribute("class",a),e}class z extends L{$aiTurn(){clearTimeout(this.view.timerID),this.view.timerID=setTimeout(()=>{super.$aiTurn()},2e3)}$stopDualBotMode(){clearTimeout(this.view.timerID)}$setTile(e,t,i){super.$setTile(e,t,i),this.thinking||this.view.$setTile(e,t,i)}$updateLastMove(e,t){this.view.$updateLastMove(e,t)}$tilesCounting(){super.$tilesCounting(),this.view.$tilesCounting()}$changeTileClassByNum(e,t){this.thinking||this.view.$changeTileClassByNum(e,t)}$glowchange(){this.sym===C.W?(this.view.$stopGlow1(),this.view.$startGlow2()):(this.view.$startGlow1(),this.view.$stopGlow2())}$tempStopAllClicks(){this.view.$tempStopAllClicks()}$startBackAllClicks(){this.view.$startBackAllClicks()}$checkWin(){const e=super.$checkWin();return this.view.$checkWin(e),e}$playerTurn(){this.view.$playerTurn()}$removePredictionDots(){this.view.$removePredictionDots()}S_invalid(){console.log("Invalid Move"),this.view.sounds.sePlay(b.Invalid)}S_place(){this.view.sounds.sePlay(b.Place)}}class H{constructor(){this.mainContainer=l(".main-container"),this.squares=[],this.blackScore=l("#black-score"),this.whiteScore=l("#white-score"),this.glow1=l("#glow-1"),this.glow2=l("#glow-2"),this.predictorArray=[],this.scoreViwLV=0,this.sounds=new E}init(e){const t=document.forms.setting.elements,i=parseInt(t.aiLv.value);clearTimeout(this.timerID),this.reversi=new z({boardSize:parseInt(t.boardSize.value),initialPlacement:t.initialPlacement.value,mode:e,yourColor:parseInt(t.yourColor.value),aiPlayer1LV:i,aiPlayer2LV:i}),this.reversi.view=this,this.addTile=s=>{const o=s.target,r=parseInt(o.getAttribute("x-axis")),n=parseInt(o.getAttribute("y-axis"));this.reversi.addTile(r,n),this.hideHandScoreDetails()},this.allBoardInitialisation(),this.closeSettingFormContainer(),this.reversi.init(),this.hideShroud(),this.$startGlow1(),this.$stopGlow2()}getSymColor(e){return e===C.W?"white":"black"}changeTileClass(e,t){e.setAttribute("class",`${this.getSymColor(t)}-tiles`)}$changeTileClassByNum(e,t){this.changeTileClass(this.squares[e].firstChild,t)}$setTile(e,t,i){const{boardSize:s}=this.reversi,o=document.createElement("div");this.changeTileClass(o,i);const r=this.squares[t*s+e];r.appendChild(o),r.removeEventListener("click",this.addTile)}$tilesCounting(){this.blackScore.innerHTML=this.reversi.blackCount+"",this.whiteScore.innerHTML=this.reversi.whiteCount+""}$startGlow1(){this.glow1.style.visibility="visible"}$startGlow2(){this.glow2.style.visibility="visible"}$stopGlow1(){this.glow1.style.visibility="hidden"}$stopGlow2(){this.glow2.style.visibility="hidden"}$tempStopAllClicks(){const{boardSize:e}=this.reversi;for(var t=0;t<e;t++)for(var i=0;i<e;i++)this.reversi.isTileEmpty(i,t)&&this.squares[t*e+i].removeEventListener("click",this.addTile)}$startBackAllClicks(){const{boardSize:e}=this.reversi;for(var t=0;t<e;t++)for(var i=0;i<e;i++)this.reversi.isTileEmpty(i,t)&&this.squares[t*e+i].addEventListener("click",this.addTile)}$checkWin(e){this.$stopGlow1(),this.$stopGlow2(),l(".win-lose-draw").innerHTML=e,this.startAnimations()}startAnimations(){const e=l(".dark-shroud");e.style.visibility="visible",e.style.animation="2s fadein forwards";const t=l(".win-lose-draw");t.style.animation="2s fadein forwards",setTimeout(()=>{const i=l(".result-container");i.style.animation="2s fadein forwards"},2e3)}$playerTurn(){const{boardSize:e}=this.reversi;this.predictorArray=[];for(let t=0;t<e;t++)for(let i=0;i<e;i++)if(this.reversi.isTileEmpty(i,t)&&this.reversi.checkOKtoPlace(i,t)){const s=t*e+i,o=this.squares[t*e+i];o.addEventListener("click",this.addTile),this.predictorArray.push(s);const r=f("can-hit");r.setAttribute("x-axis",i+""),r.setAttribute("y-axis",t+"");const n=this.scoreViwLV;if(!this.reversi.demo&&n){const h=this.reversi.getHand(i,t,n);r.textContent=h.scores.total.toFixed(1),r.addEventListener("mouseover",this.showHandScoreDetails(h)),r.addEventListener("mouseleave",this.hideHandScoreDetails)}else{const h=f("predictor");h.style.pointerEvents="none",r.appendChild(h)}o.appendChild(r)}}showHandScoreDetails(e){return t=>{const i=f("score-details");i.style.left=t.clientX+10+"px",i.style.top=t.clientY+10+"px";for(const s in e.scores){const o=e.scores[s];if(o){const r=f("score-details-item");r.innerHTML=`${s}: ${typeof o=="number"?+o.toFixed(2)+"pt":o}`;const n=e[s];n&&(r.innerHTML+=` (${n})`),i.appendChild(r)}}document.body.appendChild(i)}}hideHandScoreDetails(){for(const e of document.querySelectorAll(".score-details"))document.body.removeChild(e)}$removePredictionDots(){for(let e=0;e<this.predictorArray.length;e++){const t=this.squares[this.predictorArray[e]];t.removeChild(t.firstChild),t.removeEventListener}}closeSettingFormContainer(){l(".settings-from-container").style.display="none"}addEventToStart(){l("#single-player").addEventListener("click",()=>{this.init("single"),this.sounds.sePlay(b.Beep)}),l("#two-players").addEventListener("click",()=>{this.init("2"),this.sounds.sePlay(b.Beep)}),l("#demo").addEventListener("click",()=>{this.init("demo"),this.sounds.sePlay(b.Beep)}),l(".dark-shroud").addEventListener("click",()=>{this.hideShroud(),this.showSettingsButton(),this.sounds.sePlay(b.Beep)}),l(".result-container").addEventListener("click",e=>{e.stopPropagation()}),l("#restart").addEventListener("click",()=>{this.hideShroud(),this.removeBoard(),this.init(this.reversi.mode),this.sounds.sePlay(b.Beep)}),l("#back-to-top").addEventListener("click",()=>{this.hideShroud(),this.removeBoard(),this.reversi.$stopDualBotMode(),this.showStartPage(),this.$stopGlow1(),this.$stopGlow2(),this.sounds.sePlay(b.Beep)}),l("#menu").addEventListener("click",()=>{this.hideSettingsButton(),this.showShroud(),this.sounds.sePlay(b.Beep)})}removeBoard(){const e=document.querySelector(".board-frame");e&&(this.mainContainer.removeChild(e),this.mainContainer.removeChild(l(".last-move-display-container")))}allBoardInitialisation(){this.createBoard(),this.showSettingsButton();let e=0;const t=document.querySelectorAll(".col"),{boardSize:i}=this.reversi;for(let s=0;s<i;s++)for(let o=0;o<i;o++)t[e].setAttribute("x-axis",o+""),t[e].setAttribute("y-axis",s+""),t[e].setAttribute("id",`cell${e}`),this.reversi.demo?console.log("no clicking"):t[e].addEventListener("click",this.addTile),e++;this.hideStartPage()}createBoard(){const{boardSize:e}=this.reversi,t=f("main-board"),i=f("board-frame"),s=f("h-markers-container");for(let n=0;n<e;n++){const h=f("h-markers");s.appendChild(h),h.innerHTML=String.fromCharCode(65+n)}const o=f("v-markers-container");for(let n=0;n<e;n++){const h=f("v-markers");o.appendChild(h),h.innerHTML=n+1+""}let r=0;this.squares=[];for(let n=0;n<e;n++){const h=f("row");h.style.height=100/e+"%",r++;for(let m=0;m<e;m++){const u=f("col square");u.style.width=100/e+"%",r%2===1&&(u.style.backgroundColor="#86B50F"),r++,h.appendChild(u),this.squares.push(u)}t.appendChild(h)}i.appendChild(t),i.appendChild(s),i.appendChild(o),this.mainContainer.appendChild(i),this.lastMoveDisplayCreator()}lastMoveDisplayCreator(){const e=f("last-move-display-container");this.mainContainer.appendChild(e)}$updateLastMove(e,t){const i=l(".last-move-display-container"),s=f("last-move-slot"),o=f(`last-move-tile-${this.getSymColor(this.reversi.sym)}`);s.appendChild(o);const r=f("last-move-number");r.innerHTML=String.fromCharCode(65+e)+(t+1),s.appendChild(r),i.insertBefore(s,i.childNodes[0])}showStartPage(){l(".main-page-container").style.display="flex",l(".score-container").style.visibility="collapse",l(".settings-from-container").style.display="flex"}hideStartPage(){l(".main-page-container").style.display="none",l(".score-container").style.visibility="visible",l("#player-name").innerHTML=this.reversi.player1Name,l("#bot-name").innerHTML=this.reversi.player2Name}showSettingsButton(){l(".settings").style.visibility="visible"}hideSettingsButton(){l(".settings").style.visibility="hidden"}showShroud(){const e=l(".dark-shroud");e.style.visibility="visible",e.style.opacity="1";const t=l(".result-container");t.style.opacity="1",this.sounds.sePlay(b.Beep)}hideShroud(){l(".dark-shroud").style.visibility="hidden",l(".dark-shroud").style.opacity="0",l(".dark-shroud").style.animation="",l(".win-lose-draw").style.animation="",l(".win-lose-draw").style.opacity="0",l(".result-container").style.animation="",l(".result-container").style.opacity="0"}}document.addEventListener("DOMContentLoaded",()=>{new H().addEventToStart()});
